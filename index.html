<!DOCTYPE html>
<html lang="en"> 
<head>
  <title>CW01: Course Booking System</title>
  <script src="https://unpkg.com/vue@2"></script>
  <link rel="stylesheet" type="text/css" href="app.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="courses.js"></script>
  <style>
    /* Add any additional styles here */
  </style>
</head>
<body>
<div id="app">
  <header>
    <div class="navbar navbar-default">
      <div class="navbar-header">
        <h1>{{ sitename }}</h1>
      </div>
      
      
    </div>
  </header>
  <main>
    <div class="row product"> 
      <div v-if="showProduct">
        <div id="sortMenu">
          <form>
            <div>
              <h4>Search Item:</h4>
              <input type="text" v-model="searchQuery" placeholder="Search..." />
              <h4>Sort Menu:</h4>
              <input type="radio" id="title" v-model="sortAttribute" name="sortDetail" value="title">
              <label for="title">Title</label><br>
              <input type="radio" id="location" v-model="sortAttribute" name="sortDetail" value="location">
              <label for="location">Location</label><br>
              <input type="radio" id="availability" v-model="sortAttribute" name="sortDetail" value="availability">
              <label for="availability">Availability</label><br>
              <input type="radio" id="price" v-model="sortAttribute" name="sortDetail" value="price">
              <label for="price">Price</label>
              <br> 
            </div>

            <div>
              <input type="radio" id="ascending" v-model="isAscending" name="sortOrder" :value="true">
              <label for="ascending">Ascending</label><br>
              <input type="radio" id="descending" v-model="isAscending" name="sortOrder" :value="false">
              <label for="descending">Descending</label>
              <br> 
            </div>

            <div class="nav navbar-nav navbar-center cart">
              <button type="button" class="btn btn-default btn-lg" @click="showCheckout" :disabled="cartItemCount == 0">
                <span class="glyphicon glyphicon-shopping-cart">{{ cartItemCount }}</span> Checkout
              </button>
            </div>
          </form>        
        </div>

        <div v-for="course in filteredProducts" :key="course.id" class="col-md-2 col-md-offset-1">
          <figure>
            <img :src="course.image" alt="Course Image" width="50%">
          </figure>
          <div class="col-md-6 col-md-offset-2 location">
            <h2 v-text="course.title"></h2>
            <p v-html="course.location"></p>
            <p class="price">{{ formatPrice(course.price) }}</p>
            <button @click="addToCart(course)" v-if="canAddToCart(course)">Add to cart</button>
            <span v-if="course.availableInventory === cartCount(course.id)">All out!</span>
            <span v-else-if="itemsLeft(course) < 25">Only {{ itemsLeft(course) }} left!</span>
            <span v-else>Buy now!</span>

            <div>
              <span v-for="n in course.rating">★</span>
              <span v-for="n in 5 - course.rating">☆</span>
            </div>
          </div>
        </div>
      </div>

      <div id="CheckoutPage" v-else>

        <div v-if="showCart" class="cart-items">
          <h2>Your Cart</h2>
          <div v-if="cart.length > 0">
            <!-- Table to display cart items -->
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Image</th>
                  <th>Title</th>
                  <th>Price</th>
                  <th>Quantity</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                <!-- Loop through each course in the cart and display it in a table row -->
                <tr v-for="course in cartProducts" :key="course.id">
                  <td>
                    <!-- Display the image of the course -->
                    <img :src="course.image" alt="Course Image" width="100">
                  </td>
                  <td>{{ course.title }}</td>
                  <td>{{ formatPrice(course.price) }}</td>
                  <td>{{ cartCount(course.id) }}</td>
                  <td>{{ formatPrice(course.price * cartCount(course.id)) }}</td>
                </tr>
              </tbody>
            </table>
            
            <p>Total Amount Due: {{ formatPrice(totalAmount) }}</p> <!-- Display total amount -->
            <div id="checkInfo">
              <form name="frmCheck" id="frmCheck" @submit.prevent>
                <br/>
                <br/>
                <label for="namein">Full Name: </label>
                <br/>
                <input name="namein" type="text" placeholder="Name" />
                <br/>
                <br/>
                <label for="phonein">Phone Number: </label>
                <br/>
                <input name="phonein" type="text" placeholder="Phone" />
                <br/>
                <br/>
                <button @click="checkout" >Checkout</button>
                <br/>
                <br/>
                <button @click="clearCart">Clear Cart</button> <!-- Clear Cart Button -->
                <br/>
                <br/>
              </form>
            </div>
          </div>
        
          <div v-else>
            <p>Your cart is empty.</p>
          </div>
        
          <button @click="showCheckout">Close Cart</button>
        </div>
        

      </div>
    </div>
  </main>
</div>
<script type="text/javascript">
var APP_LOG_LIFECYCLE_EVENTS = true;
var webstore = new Vue({
  el: '#app',
  data: {
    sitename: "CW01: Course Booking System",
    showProduct: true,
    showCart: false,
    searchQuery: '',
    courses: courses,
    cart: [],
    sortAttribute: 'price',
    isAscending: true,
  },
  methods: {
    addToCart(course) {
      this.cart.push(course.id);
    },
    cartCount(id) {
      return this.cart.filter(item => item === id).length;
    },
    itemsLeft(course) {
      return course.availableInventory - this.cartCount(course.id);
    },
    formatPrice(price) {
      if (!parseInt(price)) return "";
      return "Rs" + (price).toFixed(2);
    },
    showCheckout() {
      this.showProduct = !this.showProduct;
      this.showCart = true;
    },
    canAddToCart(course) {
      return course.availableInventory > this.cartCount(course.id);
    },
    clearCart() {
      this.cart = []; // Clear the cart
    },
    checkout() {
      // Implement checkout logic here
      alert("Proceeding to checkout!");
    }
  },
  computed: {
    cartItemCount() {
      return this.cart.length || '';
    },
    filteredProducts() {
    let filtered = this.courses.filter(course => {
      // Search for title, location, or price
      const titleMatch = course.title.toLowerCase().includes(this.searchQuery.toLowerCase());
      const locationMatch = course.location.toLowerCase().includes(this.searchQuery.toLowerCase());
      const priceMatch = course.price.toString().includes(this.searchQuery);

      return titleMatch || locationMatch || priceMatch;  // Return true if any of the conditions match
    });
    return this.sortedProducts(filtered);
  },
  sortedProducts() {
    return (courses) => {
      let sorted = [...courses];
      if (this.sortAttribute === "location") {
        sorted.sort((a, b) => a.location.localeCompare(b.location));  // Sorting by title for location
      } else if (this.sortAttribute === "availability") {
        sorted.sort((a, b) => a.availableInventory - b.availableInventory);
      } else if (this.sortAttribute === "price") {
        sorted.sort((a, b) => a.price - b.price);
      } else if (this.sortAttribute === "title") {
        sorted.sort((a, b) => a.title.localeCompare(b.title));
      }
      if (!this.isAscending) {
        return sorted.reverse();
      }
      return sorted;
    };
  },
    cartProducts() {
      return this.courses.filter(course => this.cart.includes(course.id));
    },
    totalAmount() {
      return this.cartProducts.reduce((total, course) => {
        return total + course.price * this.cartCount(course.id);
      }, 0);
    },
  },
  beforeCreate: function() {
    if (APP_LOG_LIFECYCLE_EVENTS) {
      console.log("beforeCreate");
    }
  },
  created: function() {
    if (APP_LOG_LIFECYCLE_EVENTS) {
      console.log("created");
    }
  },
  beforeMount: function() {
    if (APP_LOG_LIFECYCLE_EVENTS) {
      console.log("beforeMount");
    }
  },
  mounted: function() {
    if (APP_LOG_LIFECYCLE_EVENTS) {
      console.log("mounted"); 
    }
  },
  beforeUpdate: function() {
    if (APP_LOG_LIFECYCLE_EVENTS) {
      console.log("beforeUpdate");
    }
  },
  updated: function() {
    if (APP_LOG_LIFECYCLE_EVENTS) {
      console.log("updated");
    }
  },
  beforeDestroy: function() {
    if (APP_LOG_LIFECYCLE_EVENTS) {
      console.log("beforeDestroy");
    }
  }
});
</script>
</body>
</html>
